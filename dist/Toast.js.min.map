{
  "version": 3,
  "sources": ["src/Toast.ts"],
  "sourcesContent": ["// ==============> \u76F8\u5173\u7C7B\u578B\u5B9A\u4E49\n/**\n * Toast\u914D\u7F6E\n */\nexport interface ToastConfig {\n  /**\u6D88\u606F\u7C7B\u578B */\n  type: ToastType;\n  /**\u6D88\u606F\u4F53 */\n  msg: ToastMsgItem | ToastMsgItem[];\n  /**\u81EA\u52A8\u5173\u95ED\u65F6\u95F4(\u6BEB\u79D2) */\n  timer: number;\n}\n/**\n * Toast\u4FE1\u606F\u7C7B\u578B\n */\nexport enum ToastType {\n  /**\u6210\u529F */\n  Success = \"success\",\n  /**\u5931\u8D25|\u9519\u8BEF */\n  Error = \"error\",\n  /**\u8B66\u544A */\n  Warn = \"warn\",\n  /**\u4FE1\u606F */\n  Info = \"info\",\n}\n/**\n * Toast\u6D88\u606F\u4F53\n */\nexport interface ToastMsgBody {\n  /**\u6D88\u606F\u6587\u672C */\n  text: string;\n  /**\u6D88\u606F\u56DE\u8C03 */\n  call?: Function;\n  /**\u9644\u52A0\u7684\u7C7B\u540D */\n  class?: string;\n}\nexport type ToastMsgItem = string | ToastMsgBody;\n\n// ==============> \u76F8\u5173\u9ED8\u8BA4\u914D\u7F6E\n/**\n * \u9ED8\u8BA4\u914D\u7F6E\n */\nconst defaultConfig: ToastConfig = {\n  type: ToastType.Info,\n  msg: \"This is a toast message.\",\n  timer: 3000,\n};\n/**\u6D88\u606F\u9762\u677F\u6A21\u677F */\nconst msgTemp = `\n<div id=\"<%= id %>\" class=\"toast-panel\">\n    <div class=\"body <%= type %>\">\n        <div class=\"icon <%= icon %>\"></div>\n        <div class=\"msg\"><%= msg-body %></div>\n        <div class=\"btns\">\n            <div class=\"timer <%= timer-class %>\"><%= timer %></div>\n            <div class=\"close\">x</div>\n        </div>\n    </div>\n</div>`;\nconst defaultContainer = \"toast-container\";\n\n// ==============> Class\n/**\n * Toast Message\n */\nexport class Toast {\n  /**Toast\u7684\u5BB9\u5668 */\n  static container: string = \"#\" + defaultContainer;\n  /**\u6700\u5927\u53EF\u663E\u793A\u6570\u91CF */\n  static maxCount: number | null = null;\n  /**\u914D\u7F6E\u4FE1\u606F */\n  readonly config: ToastConfig;\n  /**\u6D88\u606F\u9762\u677FID */\n  private panelId: string = \"\";\n  /**\u56DE\u8C03\u51FD\u6570 */\n  private calls: Function[] = [];\n  /**\u5B9A\u65F6\u5668id */\n  private timerIntervalId: number;\n\n  /**\n   * \u8BBE\u7F6EToast\u7684\u5BB9\u5668\u4F4D\u7F6E\n   * @param selectors string \u9009\u62E9\u5668\n   */\n  static setContainer(selectors: string) {\n    this.container = selectors;\n  }\n\n  static setMaxCount(number?: number) {\n    this.maxCount = number || null;\n  }\n\n  constructor(config: Partial<ToastConfig>) {\n    this.config = this.initConfig(config);\n    if (!this.config.msg) {\n      return;\n    }\n    this.show(this.createPanel());\n  }\n\n  /**\n   * \u914D\u7F6E\u521D\u59CB\u5316\n   */\n  private initConfig(config: Partial<ToastConfig>): ToastConfig {\n    const c: ToastConfig = Object.assign({}, defaultConfig, config);\n    c.timer = Math.round(c.timer);\n    if (c.timer < 0) {\n      c.timer = defaultConfig.timer;\n    }\n    return c;\n  }\n\n  /**\n   * \u521B\u5EFAToast\u9762\u677F\n   */\n  private createPanel() {\n    const c = this.config;\n    // \u6D88\u606F\u4F53\u7684\u521B\u5EFA\n    const msg = Array.isArray(c.msg) ? c.msg : [c.msg];\n    let msgBody = \"\";\n    msg.forEach((item) => {\n      if (typeof item === \"string\") {\n        msgBody += `<span>${item}</span>`;\n      } else {\n        item.class = item.class || \"\";\n        if (item.call) {\n          this.calls.push(item.call);\n          msgBody += `<a href=\"#\" class=\"${item.class}\" call-index=\"${\n            this.calls.length - 1\n          }\">${item.text}</a>`;\n        } else {\n          msgBody += `<span class=\"${item.class}\">${item.text}</span>`;\n        }\n      }\n    });\n    // \u9762\u677F\n    this.panelId = \"toast-\" + new Date().getTime();\n    const panelHtml = this.rendTemplate(msgTemp, {\n      id: this.panelId,\n      type: c.type,\n      icon: \"icon-toast-\" + c.type,\n      timer: this.convertPanelTimer(c.timer),\n      \"timer-class\": c.timer === 0 ? \"hidden\" : \"\",\n      \"msg-body\": msgBody,\n    });\n    // \u521B\u5EFA\u8282\u70B9\n    const fragement = document.createDocumentFragment();\n    const nodes = new DOMParser().parseFromString(panelHtml, \"text/html\").body\n      .childNodes;\n    nodes.forEach((n) => fragement.append(n));\n    // \u7ED1\u5B9A\u4E8B\u4EF6\n    fragement\n      .querySelector(\".btns > .close\")\n      .addEventListener(\"click\", this.close.bind(this));\n    if (this.calls.length > 0) {\n      fragement.querySelectorAll(\"a[call-index]\").forEach((item) => {\n        item.addEventListener(\"click\", (e) => {\n          const index = +(e.target as Element).getAttribute(\"call-index\");\n          const call = this.calls[index];\n          call && call.apply(null);\n        });\n      });\n    }\n    return fragement;\n  }\n\n  /**\n   * \u66F4\u65B0\u6A21\u677F\n   */\n  private rendTemplate(temp: string, obj: { [key: string]: string }) {\n    if (!obj || !temp) {\n      return temp;\n    }\n    for (let key in obj) {\n      temp = temp.replace(new RegExp(`<%=\\\\s*(${key})\\\\s*%>`, \"g\"), obj[key]);\n    }\n    return temp;\n  }\n\n  /**\n   * \u521D\u59CB\u5316Toast\u9762\u677F\n   */\n  private initContainer(): Element {\n    const container = document.createElement(\"div\");\n    container.id = defaultContainer;\n    document.body.appendChild(container);\n    return container;\n  }\n\n  private convertPanelTimer(timer: number) {\n    return Math.round(timer / 1000 || 0).toString();\n  }\n\n  private getPanel() {\n    return document.getElementById(this.panelId) as HTMLElement;\n  }\n\n  private getPanelTimerEle() {\n    return this.getPanel().querySelector(\".btns > .timer\");\n  }\n\n  private getPanelTimer() {\n    return parseFloat(this.getPanelTimerEle().textContent) * 1000;\n  }\n\n  private updatePanelTimer(timer: number) {\n    return (this.getPanelTimerEle().textContent =\n      this.convertPanelTimer(timer));\n  }\n\n  /**\n   * \u663E\u793A\n   */\n  private show(fragement: DocumentFragment) {\n    if (!fragement) {\n      return;\n    }\n    let container = document.querySelector(Toast.container);\n    if (!container) {\n      container = this.initContainer();\n    }\n    // \u5173\u95ED\u8D85\u51FA\u7684\u6D88\u606F\n    if (Toast.maxCount > 0) {\n      const panels = container.querySelectorAll(\"* > .toast-panel\");\n      const needClose = panels.length - Toast.maxCount + 1;\n      for (let i = 0; i < needClose; i++) {\n        const closeBtn = panels[i].querySelector(\n          \".btns > .close\"\n        ) as HTMLElement;\n        closeBtn && closeBtn.click();\n      }\n    }\n    container.appendChild(fragement);\n    // \u5165\u573A\u52A8\u753B\n    const enterClass = \"enter-in\";\n    const panel = this.getPanel();\n    panel.classList.add(enterClass);\n    const marginBottom = 7;\n    panel.style.height = (panel.clientHeight || 44) + marginBottom + \"px\";\n    const enterTimer = 300;\n    panel.classList.add(enterClass);\n\n    setTimeout(() => {\n      panel.classList.remove(enterClass);\n      // \u5012\u8BA1\u65F6\u81EA\u52A8\u5173\u95ED\n      let timer = this.config.timer;\n      if (timer === 0) {\n        return;\n      }\n      timer -= enterTimer;\n      if (timer < 0) {\n        this.close();\n        return;\n      }\n      const timerGap = 1000;\n      const leaveTimer = 300;\n      this.updatePanelTimer(timer);\n      this.timerIntervalId = setInterval(() => {\n        const panelTimer = this.getPanelTimer() - timerGap;\n        if (panelTimer < leaveTimer) {\n          setTimeout(() => {\n            this.close();\n          }, Math.max(0, panelTimer - leaveTimer));\n        } else {\n          this.updatePanelTimer(panelTimer);\n        }\n      }, timerGap);\n    }, enterTimer);\n  }\n\n  /**\n   * \u5173\u95ED\n   */\n  private close() {\n    const panel = this.getPanel();\n    if (!panel) {\n      return;\n    }\n    clearInterval(this.timerIntervalId);\n    this.panelId = \"\";\n    // \u79BB\u573A\u52A8\u753B\n    const leaveTimer = 300;\n    panel.classList.add(\"leave-to\");\n    setTimeout(() => {\n      panel.parentElement.removeChild(panel);\n    }, leaveTimer);\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
